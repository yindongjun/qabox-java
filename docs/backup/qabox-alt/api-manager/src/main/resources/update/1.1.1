SET FOREIGN_KEY_CHECKS=0;
CREATE TABLE `at_data_pool` ( `pool_id` int(11) NOT NULL AUTO_INCREMENT COMMENT '数据池ID', `name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '数据池名称', `mark` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL COMMENT '备注信息', `user_id` int(11) NULL DEFAULT NULL COMMENT '创建用户', `create_time` datetime(0) NULL DEFAULT NULL COMMENT '创建时间', `project_id` int(11) NULL DEFAULT NULL COMMENT '所属项目', PRIMARY KEY (`pool_id`) USING BTREE, INDEX `at_data_pool_fk_user_id`(`user_id`) USING BTREE, INDEX `at_data_pool_fk_project_id`(`project_id`) USING BTREE, CONSTRAINT `at_data_pool_fk_project_id` FOREIGN KEY (`project_id`) REFERENCES `at_project_info` (`project_id`) ON DELETE RESTRICT ON UPDATE RESTRICT, CONSTRAINT `at_data_pool_fk_user_id` FOREIGN KEY (`user_id`) REFERENCES `at_user` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT ) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci ROW_FORMAT = Dynamic;
CREATE TABLE `at_pool_data_item` ( `item_id` int(11) NOT NULL AUTO_INCREMENT COMMENT '数据池类别ID', `name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '数据名称', `pool_id` int(11) NULL DEFAULT NULL COMMENT '所属池ID', `message_scene_id` int(11) NULL DEFAULT NULL COMMENT '通过关联测试场景去获取数据', `scene_system_id` int(11) NULL DEFAULT NULL COMMENT '接口场景的测试环境', `use_message_scene` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '1' COMMENT '优先使用测试场景去请求数据，否则优先使用request_url', `request_url` varchar(1000) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '通过接口获取，接口必须为get请求，且返回json', `mark` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL COMMENT '备注信息', `user_id` int(11) NULL DEFAULT NULL COMMENT '创建用户', `create_time` datetime(0) NULL DEFAULT NULL COMMENT '创建时间', `before_use_auto_update` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '0' COMMENT '使用前自动更新数据，前提是必须配置了requestUrl或者messageScene', `response_data_json_path` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '通过请求获取的结果中，需要的测试数据所在的JSON_PATH,例如ROOT.OUT_DATA.DATA', PRIMARY KEY (`item_id`) USING BTREE, INDEX `at_pool_data_item_fk_message_scene_id`(`message_scene_id`) USING BTREE, INDEX `at_pool_data_item_fk_scene_system_id`(`scene_system_id`) USING BTREE, CONSTRAINT `at_pool_data_item_fk_message_scene_id` FOREIGN KEY (`message_scene_id`) REFERENCES `at_message_scene` (`message_scene_id`) ON DELETE RESTRICT ON UPDATE RESTRICT, CONSTRAINT `at_pool_data_item_fk_scene_system_id` FOREIGN KEY (`scene_system_id`) REFERENCES `at_business_system` (`system_id`) ON DELETE RESTRICT ON UPDATE RESTRICT ) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci ROW_FORMAT = Dynamic;
CREATE TABLE `at_pool_data_name` ( `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '数据ID', `pool_id` int(11) NULL DEFAULT NULL COMMENT '数据池ID', `name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '数据name值', `default_value` varchar(2000) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '默认值', `mark` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL COMMENT '备注信息', `user_id` int(11) NULL DEFAULT NULL COMMENT '创建用户', `create_time` datetime(0) NULL DEFAULT NULL COMMENT '创建时间', PRIMARY KEY (`id`) USING BTREE, INDEX `at_pool_data_fk_user_id`(`user_id`) USING BTREE, INDEX `at_pool_data_fk_pool_id`(`pool_id`) USING BTREE, CONSTRAINT `at_pool_data_fk_pool_id` FOREIGN KEY (`pool_id`) REFERENCES `at_data_pool` (`pool_id`) ON DELETE RESTRICT ON UPDATE RESTRICT, CONSTRAINT `at_pool_data_fk_user_id` FOREIGN KEY (`user_id`) REFERENCES `at_user` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT ) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci ROW_FORMAT = Dynamic;
CREATE TABLE `at_pool_data_value` ( `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'id', `value` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '数据值，可填写全局的变量模版', `name_id` int(11) NULL DEFAULT NULL COMMENT '对应的name', `user_id` int(11) NULL DEFAULT NULL COMMENT '创建用户', `create_time` datetime(0) NULL DEFAULT NULL COMMENT '创建时间', `item_id` int(11) NULL DEFAULT NULL COMMENT '所属的池的数据类别ID', `mark` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL COMMENT '备注', PRIMARY KEY (`id`) USING BTREE ) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci ROW_FORMAT = Dynamic;
ALTER TABLE `at_test_config` ADD COLUMN `pool_id` int(11) NULL DEFAULT NULL COMMENT '数据池' AFTER `public_header`;
ALTER TABLE `at_test_config` ADD COLUMN `pool_item_ids` varchar(2000) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '数据池下的类别，默认测试所有，否则只测试选中的' AFTER `pool_id`;
ALTER TABLE `at_test_config` MODIFY COLUMN `config_id` int(11) NOT NULL COMMENT '配置ID' FIRST;
ALTER TABLE `at_test_config` MODIFY COLUMN `user_id` int(11) NULL DEFAULT NULL COMMENT '所属用户' AFTER `config_id`;
ALTER TABLE `at_test_config` MODIFY COLUMN `run_type` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT '运行模式，并行或者串行' AFTER `check_Data_flag`;
ALTER TABLE `at_test_config` MODIFY COLUMN `systems` varchar(2000) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT ' ' COMMENT '测试环境，不配置默认取第一个，否则测试所有可用环境' AFTER `retry_count`;
ALTER TABLE `at_test_config` MODIFY COLUMN `top_scenes` varchar(2000) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT ' ' COMMENT '指定测试场景的ID' AFTER `systems`;
ALTER TABLE `at_test_config` MODIFY COLUMN `config_id` int(11) NOT NULL AUTO_INCREMENT COMMENT '配置ID' FIRST;
ALTER TABLE `at_test_config` ADD CONSTRAINT `at_test_config_fk_pool_id` FOREIGN KEY (`pool_id`) REFERENCES `at_data_pool` (`pool_id`) ON DELETE RESTRICT ON UPDATE RESTRICT;
ALTER TABLE `at_test_config` ADD INDEX `at_test_config_fk_pool_id`(`pool_id`) USING BTREE;
ALTER TABLE `at_test_result` ADD COLUMN `pool_item_id` int(11) NULL DEFAULT NULL COMMENT '测试数据所属数据池类别' AFTER `message_type`;
ALTER TABLE `at_test_result` ADD CONSTRAINT `at_test_result_fk_pool_item_id` FOREIGN KEY (`pool_item_id`) REFERENCES `at_pool_data_item` (`item_id`) ON DELETE RESTRICT ON UPDATE RESTRICT;
ALTER TABLE `at_test_result` ADD INDEX `at_test_result_fk_pool_item_id`(`pool_item_id`) USING BTREE;
SET FOREIGN_KEY_CHECKS=1;