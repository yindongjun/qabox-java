(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-10ae499c","chunk-2d22b908","chunk-2d2304b2"],{"26bf":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("page-view",{attrs:{avatar:"",title:!1,"header-disabled":!0}},[s("a-card",{attrs:{bordered:!1}},[s("div",{staticClass:"table-page-search-wrapper"},[s("a-form",{attrs:{layout:"inline"}},[s("a-row",{attrs:{gutter:48}},[s("a-col",{attrs:{md:8,sm:24}},[s("a-form-item",{attrs:{label:"角色名称/描述"}},[s("a-input",{attrs:{placeholder:"请输入"},model:{value:e.queryParam.searchWord,callback:function(t){e.$set(e.queryParam,"searchWord",t)},expression:"queryParam.searchWord"}})],1)],1),s("a-col",{attrs:{md:8,sm:24}},[s("a-form-item",{attrs:{label:"状态"}},[s("a-select",{attrs:{placeholder:"请选择"},model:{value:e.queryParam.status,callback:function(t){e.$set(e.queryParam,"status",t)},expression:"queryParam.status"}},[s("a-select-option",{attrs:{value:"-1"}},[e._v("全部")]),s("a-select-option",{attrs:{value:"1"}},[e._v("正常")]),s("a-select-option",{attrs:{value:"0"}},[e._v("禁用")])],1)],1)],1),s("a-col",{attrs:{md:8,sm:24}},[s("span",{staticClass:"table-page-search-submitButtons"},[s("a-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("查询")]),s("a-button",{staticStyle:{"margin-left":"8px"},on:{click:e.reset}},[e._v("重置")])],1)])],1)],1)],1),s("div",{staticClass:"table-page-operator-wrapper"},[s("a-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"sys:role:save",expression:"'sys:role:save'"}],attrs:{type:"primary",ghost:""},on:{click:function(t){return e.$refs.roleEditPanel.show()}}},[e._v("新增")]),s("a-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"sys:role:delete",expression:"'sys:role:delete'"}],attrs:{disabled:0===e.selectedRowKeys.length},on:{click:function(t){return e.batchDelete(e.selectedRowKeys)}}},[e._v("删除")]),s("a-dropdown",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"sys:role:export",expression:"'sys:role:export'"}]},[s("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[s("a-menu-item",{key:"export-data",on:{click:e.exprotExccel}},[e._v("导出Excel")])],1),s("a-button",[e._v(" 更多操作 "),s("a-icon",{attrs:{type:"down"}})],1)],1)],1),s("s-table",{ref:"table",attrs:{columns:e.columns,data:e.loadData,rowKey:"id","row-selection":e.rowSelection},scopedSlots:e._u([{key:"expandedRowRender",fn:function(t){return s("div",{staticStyle:{margin:"0"}},[s("resource-panel",{attrs:{resourceIds:t.resourceIds||[],"action-name":"sys:role:update"},on:{"add-action":function(s){return e.$refs.roleEditPanel.show(t)}}})],1)}},{key:"action",fn:function(t,a){return s("span",{},[s("a",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"sys:role:update",expression:"'sys:role:update'"}],on:{click:function(t){return e.$refs.roleEditPanel.show(a)}}},[e._v("编辑")]),s("a-divider",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"sys:role:update",expression:"'sys:role:update'"}],attrs:{type:"vertical"}}),s("a-dropdown",[s("a",{staticClass:"ant-dropdown-link"},[e._v(" 更多 "),s("a-icon",{attrs:{type:"down"}})],1),s("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[s("a-menu-item",[s("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.$refs.roleEditPanel.show(a,!0)}}},[e._v("详情")])]),"1"===a.status?s("a-menu-item",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"sys:role:disabled",expression:"'sys:role:disabled'"}]},[s("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.updateStatus(a)}}},[e._v("禁用")])]):e._e(),"0"===a.status?s("a-menu-item",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"sys:role:useable",expression:"'sys:role:useable'"}]},[s("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.updateStatus(a)}}},[e._v("启用")])]):e._e(),s("a-menu-item",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"sys:role:delete",expression:"'sys:role:delete'"}]},[s("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.deleteRecord(a)}}},[e._v("删除")])])],1)],1)],1)}},{key:"status",fn:function(t){return["1"===t?s("a-tag",{attrs:{color:"green"}},[e._v(" "+e._s(e._f("getLabel")(t,"sys_role_state"))+" ")]):"0"===t?s("a-tag",[e._v(" "+e._s(e._f("getLabel")(t,"sys_role_state"))+" ")]):e._e()]}}])}),s("role-edit-panel",{ref:"roleEditPanel",on:{"handle-success":e.formHandleSuccess}})],1)],1)},r=[],n=(s("a15b"),s("b0c0"),s("680a")),o=s("2af9"),i=s("ec53"),l=s("f008"),c=s("4360"),u=o["a"].Item,d={name:"TableList",components:{PageView:n["c"],STable:o["g"],DescriptionList:o["a"],DescriptionListItem:u,RoleEditPanel:i["default"],ResourcePanel:l["default"]},data:function(){var e=this;return{description:"列表使用场景：后台管理中的权限管理以及角色管理，可用于基于 RBAC 设计的角色权限控制，颗粒度细到每一个操作类型。",visible:!1,form:null,mdl:{},advanced:!1,queryParam:{status:"-1"},columns:[{title:"唯一识别码",dataIndex:"roleKey"},{title:"角色名称",dataIndex:"name"},{title:"描述",dataIndex:"description"},{title:"状态",dataIndex:"status",scopedSlots:{customRender:"status"}},{title:"操作",width:"150px",dataIndex:"action",scopedSlots:{customRender:"action"}}],loadData:function(t){e.refreshStore();var s=Object.assign({},e.queryParam);return"-1"===s.status&&delete s.status,e.$http.get("/role",{params:Object.assign(t,s)}).then((function(e){return{data:e.page.records,pageSize:e.page.limit,pageNo:e.page.pageNo,totalCount:e.page.total}}))},selectedRowKeys:[],selectedRows:[],rowSelection:{onChange:function(t,s){e.selectedRowKeys=t,e.selectedRows=s},onSelect:function(e,t,s){},onSelectAll:function(e,t,s){}}}},methods:{search:function(){this.$refs.table.refresh(!0)},reset:function(){this.queryParam={status:"-1"},this.$refs.table.refresh(!0)},exprotExccel:function(){},updateStatus:function(e){var t=this,s="1"===e.status?"0":"1";this.$http.put("/role/updateStatus",{id:e.id,status:s}).then((function(e){e.data?(t.$message.success("操作成功"),t.$refs.table.refresh()):t.$message.error(e.data||"操作失败")}))},deleteRecord:function(e){var t=this;this.$confirm({title:"警告",content:"真的要删除 ".concat(e.name," 吗?"),okText:"删除",okType:"danger",cancelText:"取消",onOk:function(){t.handleDelete([e.id],{success:function(){},done:function(){}})}})},batchDelete:function(e){var t=this;this.$confirm({title:"警告",content:"真的要删除这 ".concat(e.length," 类角色吗?"),okText:"删除",okType:"danger",cancelText:"取消",onOk:function(){t.handleDelete(e,{success:function(){},done:function(){}})}})},handleDelete:function(e,t){var s=this;e.length>0&&this.$http.delete("role/"+e.join(",")).then((function(e){s.$message.success("已成功删除"),s.$refs.table.refresh(),t&&("function"===typeof t.done&&t.done.call(s),"function"===typeof t.success&&t.success.call(s,e))})).catch((function(e){t&&("function"===typeof t.done&&t.done.call(s),"function"===typeof t.fail&&t.fail.call(s,e))}))},onChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t},toggleAdvanced:function(){this.advanced=!this.advanced},formHandleSuccess:function(){this.$refs.table.refresh()},refreshStore:function(){c["a"].dispatch("AllRoles").then((function(){}))}},watch:{}},m=d,f=s("2877"),p=Object(f["a"])(m,a,r,!1,null,null,null);t["default"]=p.exports},ec53:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("standard-drawer",{ref:"standardDrawer",attrs:{title:e.readOnly?"详情":e.form.id?"角色编辑":"新增操作",confirmLoading:e.confirmLoading,editable:!e.readOnly},on:{close:e.close,confirm:e.confirm}},[s("a-form-model",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[s("a-form-model-item",{ref:"roleKey",attrs:{label:"唯一识别",prop:"roleKey"}},[s("a-input",{attrs:{disabled:!e.readOnly&&"undefined"!==typeof e.form.id,placeholder:"请输入唯一识别标记"},model:{value:e.form.roleKey,callback:function(t){e.$set(e.form,"roleKey",t)},expression:"form.roleKey"}})],1),s("a-form-model-item",{ref:"name",attrs:{label:"角色名称",prop:"name"}},[s("a-input",{attrs:{placeholder:"请输入菜单名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),s("a-form-model-item",{attrs:{label:"状态",prop:"status"}},[s("a-radio-group",{model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},e._l(e.roleStatus,(function(t){return s("a-radio-button",{key:t.value,attrs:{value:t.value}},[e._v(" "+e._s(t.label)+" ")])})),1)],1),s("a-form-model-item",{attrs:{label:"角色描述",prop:"description"}},[s("a-input",{attrs:{type:"textarea",placeholder:"请输入角色描述"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),s("a-form-model-item",{attrs:{label:"权限分配",prop:"resourceIds"}},[s("a-tree",{staticStyle:{width:"100%"},attrs:{checkable:"","auto-expand-parent":!0,"default-expand-all":!0,multiple:!0,"check-strictly":!0,"default-expanded-keys":e.defaultExpandedKeys,"tree-data":e.treeData,replaceFields:{title:"name",key:"id",value:"id"}},model:{value:e.form.resourceIds,callback:function(t){e.$set(e.form,"resourceIds",t)},expression:"form.resourceIds"}})],1)],1)],1)},r=[],n=s("b775"),o=s("2af9"),i={name:"RoleEditPanel",components:{StandardDrawer:o["h"],IconSelector:o["d"]},data:function(){return{roleStatus:this.$dic.query("sys_role_state"),confirmLoading:!1,defaultExpandedKeys:[],treeData:[],readOnly:!1,labelCol:{span:4},wrapperCol:{span:18},form:{name:"",resourceIds:[],description:"",status:void 0,roleKey:void 0},rules:{name:[{required:!0,message:"此项为必输项",trigger:"blur"},{max:20,message:"最多输入20个字符",trigger:"change"}],roleKey:[{required:!0,message:"此项为必输项",trigger:"blur"},{max:50,message:"最多输入50个字符",trigger:"change"}],status:[{required:!0,message:"此项为必选项",trigger:"change"}],resourceIds:[{required:!0,message:"此项为必选项",trigger:"select"}]}}},methods:{show:function(e,t){e&&(this.form=Object.assign({},e)||{}),this.readOnly="undefined"!==typeof t&&!0===t,this.defaultExpandedKeys=this.form.resourceIds,this.loadMenuTree(),this.$refs.standardDrawer.show()},confirm:function(){var e=this;this.confirmLoading=!0,this.$refs.ruleForm.validate((function(t){var s=Object.assign({},e.form);if(s.resourceIds instanceof Array||!s.resourceIds.checked||(s.resourceIds=s.resourceIds.checked),!t)return e.confirmLoading=!1;(e.form.id?e.$http.put:e.$http.post)("role",s).then((function(t){e.$message.success("操作成功！"),e.$emit("handle-success"),e.$refs.standardDrawer.close()})).catch((function(t){e.confirmLoading=!1}))}))},close:function(){this.form={name:"",resourceIds:[],description:"",status:void 0,roleKey:void 0},this.confirmLoading=!1,this.$refs.ruleForm.resetFields()},loadMenuTree:function(){var e=this;Object(n["b"])({url:"resource/tree?status=1",method:"get"}).then((function(t){e.treeData=t.data||[]}))},handleIconChange:function(e){this.form.icon=e}}},l=i,c=s("2877"),u=Object(c["a"])(l,a,r,!1,null,"36b1e536",null);t["default"]=u.exports},f008:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.emptyShow&&0===e.resourcesTree.menus.length&&0===e.resourcesTree.mix.length?s("a-empty",{attrs:{"image-style":{height:"60px"}}},[s("span",{attrs:{slot:"description"},slot:"description"},[e._v(" 无独立权限 "),s("a",{directives:[{name:"has-permission",rawName:"v-has-permission",value:e.actionName,expression:"actionName"}],on:{click:e.addPermission}},[e._v("去添加")])])]):e._e(),s("description-list",{attrs:{title:"",size:"small",column:1}},[e.resourcesTree.menus.length>0?s("description-list-item",{attrs:{label:"独立菜单( "+e.resourcesTree.menus.length+" )"}},e._l(e.resourcesTree.menus,(function(t){return s("a-tag",{key:t.id,attrs:{color:"orange"}},[e._v(e._s(t.label))])})),1):e._e()],1),e.resourcesTree.mix.length>0?s("description-list",{attrs:{title:"",size:"small",column:2}},e._l(e.resourcesTree.mix,(function(t){return s("description-list-item",{key:t.id,attrs:{label:t.label}},e._l(t.btns,(function(t){return s("a-tag",{key:t.id,attrs:{color:"cyan"}},[e._v(e._s(t.label))])})),1)})),1):e._e()],1)},r=[],n=(s("4160"),s("c975"),s("45fc"),s("159b"),s("2af9")),o=n["a"].Item,i={name:"ResourcePanel",components:{DescriptionList:n["a"],DescriptionListItem:o},props:{resourceIds:{type:Array,default:function(){return[]}},emptyShow:{type:Boolean,default:!0},actionName:{type:String,default:""}},computed:{resourcesTree:function(){var e=this,t=[],s=[],a=[],r={},n={};if(this.resourceIds&&this.resourceIds.length>0)for(var o in this.$store.getters.allResources.forEach((function(t){if(e.resourceIds.indexOf(t.id)>-1){var s=Object.assign({},t);r[t.id]=s,2===t.category&&"undefined"===typeof n[t.id]&&(n[t.id]=s,a.push(s))}})),a.some((function(e){r[e.parentId]&&("undefined"===typeof r[e.parentId].btns&&(r[e.parentId].btns=[]),r[e.parentId].btns.push(e),delete r[e.id])})),r){var i=r[o];i.btns?s.push(i):t.push(i)}return{menus:t,mix:s}}},created:function(){},methods:{addPermission:function(){this.$emit("add-action")}}},l=i,c=s("2877"),u=Object(c["a"])(l,a,r,!1,null,"e6805158",null);t["default"]=u.exports}}]);